"extends: default.liquid\n\ntitle:      Afraid of Makefiles? Don\'t be!\ndate:       15 Aug 2017 00:00:00 +0000\nhumandate:  15th of August 2017\npath:       2017/makefiles\nexcerpt:    In the last few years, I\'ve had the pleasure to work with a lot of talented Software Engineers.\n            One thing that struck me is, that many of them did not have any working knowledge of `Makefiles` \n            and why they are useful. Let\'s change that!\nsocial_img: 2017_makefiles.png\ncomments: \n  - <a href=\"https://news.ycombinator.com/item?id=15041986\">Hacker News</a>\n  - <a href=\"https://www.reddit.com/r/programming/comments/6u2yen/afraid_of_makefiles_dont_be/\">Reddit</a>\n  - <a href=\"https://lobste.rs/s/rkxbue/afraid_makefiles_dont_be\">Lobsters</a>\n---\n\n<figure>\n  <object data=\"/img/posts/2017/make/clothes.svg\" type=\"image/png\"></object>\n  <figcaption>\n  What do clothes have to do with Makefiles? Find out in this post.\n  <a href=\"http://www.freepik.com/free-photos-vectors/background\">Illustration by Anindyanfitri - Freepik.com</a>\n  </figcaption>\n</figure\n\nIn the last few years, I\'ve had the pleasure to work with a lot of talented Software Engineers.\nOne thing that struck me is, that many of them did not have any working knowledge of `Makefiles` \nand why they are useful.\n\nWhen faced with the task to automate a build process, they often roll their own shell scripts.\nCommon culprits are called `build.sh` or `run.sh` or `doall.sh` etc.  \n\nThey implement the same basic functionality over and over again:\n\n* Parsing input parameters and environment variables.\n* Manually managing dependencies between build steps.\n* Error handling... maybe.\n\nAlong the way, they keep doing the same basic mistakes:\n\n* Incorrectly handling [input parameters](http://www.pixelbeat.org/programming/shell_script_mistakes.html) and [environment variables](https://en.wikipedia.org/wiki/Shellshock_(software_bug)).\n* Missing dependencies between build steps.\n* [Forgetting to handle errors](http://www.davidpashley.com/articles/writing-robust-shell-scripts/) and &mdash; even worse &mdash; carrying on with the program execution.\n\n### Makefiles are scary!\n\nIf you think that `make` is scary, you probably think of complicated build machinery for [big](https://community.kde.org/Guidelines_and_HOWTOs/Build_from_source) [software](https://chromium.googlesource.com/chromium/src/+/lkcr/docs/linux_build_instructions.md) projects.\nIt doesn\'t need to be that way. Let\'s hear what the author of `make`, [Stuart Feldman](https://en.wikipedia.org/wiki/Stuart_Feldman) has to say:\n\n> It began with an elaborate idea of a dependency analyzer, boiled down to something much simpler, and turned into Make that weekend. Use of tools that were still wet was part of the culture. Makefiles were text files, not magically encoded binaries, because **that was the Unix ethos: printable, debuggable, understandable stuff.**  \n>\n> &mdash; [The Art of Unix Programming (2003)](http://nakamotoinstitute.org/static/docs/taoup.pdf)\n\n### Makefiles are simple!\n\nBefore I leave the house, I need to get dressed.\nI use the same simple routine every time:\nUnderpants, trousers, shirt, pullover, socks, shoes, jacket.\nMost likely you also have a routine, even though yours might be different.\n\nSome of these steps depend on each other.  \n`Make` is good for handling dependencies.  \nLet\'s try to express my routine as a `Makefile`.\n\n```make\ndress: trousers shoes jacket\n\t@echo \"All done. Let\'s go outside!\"\n\njacket: pullover\n\t@echo \"Putting on jacket.\"\n\npullover: shirt\n\t@echo \"Putting on pullover.\"\n\nshirt:\n\t@echo \"Putting on shirt.\"\n\ntrousers: underpants\n\t@echo \"Putting on trousers.\"\n\nunderpants:\n\t@echo \"Putting on underpants.\"\n\nshoes: socks\n\t@echo \"Putting on shoes.\"\n\nsocks: pullover\n\t@echo \"Putting on socks.\"\n```\n\nIf we execute the `Makefile`, we get the following output:\n\n```\n$ make dress\nPutting on underpants.\nPutting on trousers.\nPutting on shirt.\nPutting on pullover.\nPutting on socks.\nPutting on shoes.\nPutting on jacket.\nAll done. Let\'s go outside!\n```\n\n### What just happened?\n\nNoticed how the steps are in the correct order?\nBy plainly writing down the dependencies between the steps, `make` helps us to execute them correctly.\n\nEach build step has the following structure:\n\n```make\ntarget: [dependencies]\n\t<shell command to execute>\n\t<shell command to execute>\n\t...\n```\n\n* The first target in a `Makefile` will be executed by default when we call `make`.  \n* The order of the targets does not matter.  \n* Shell commands must be indented with a tab.\n* Add an `@` sign to suppress output of the command that is executed.\n* If `target` isn\'t a file you want to build, please add `.PHONY <target>` at the end of the build step.\n  Common phony targets are: clean, install, run,...\n\n  ```make\n  install: \n  \tnpm install\n  .PHONY: install\n  ```\n  Otherwise, if somebody creates an `install` directory, `make` will silently fail, because the build target already exists.\n\nCongratulations! You\'ve learned 90% of what you need to know about `make`.\n\n### Next steps\n\nReal `Makefiles` can do much more! They will [only build the files that have changed](https://stackoverflow.com/a/3798609/270334) instead of doing a full rebuild.\nAnd they will do [as much as possible in parallel](https://stackoverflow.com/a/3841803/270334)."
extends: default.liquid

title:      Afraid of Makefiles? Don't be!
date:       15 Aug 2017 00:00:00 +0000
humandate:  15th of August 2017
path:       2017/makefiles
excerpt:    In the last few years, I've had the pleasure to work with a lot of talented Software Engineers.
            One thing that struck me is, that many of them did not have any working knowledge of `Makefiles` 
            and why they are useful. Let's change that!
social_img: 2017_makefiles.png
comments: 
  - <a href="https://news.ycombinator.com/item?id=15041986">Hacker News</a>
  - <a href="https://www.reddit.com/r/programming/comments/6u2yen/afraid_of_makefiles_dont_be/">Reddit</a>
  - <a href="https://lobste.rs/s/rkxbue/afraid_makefiles_dont_be">Lobsters</a>
---

<figure>
  XXXXXXXXXXXXXX
  <figcaption>
  What do clothes have to do with Makefiles? Find out in this post.
  <a href="http://www.freepik.com/free-photos-vectors/background">Illustration by Anindyanfitri - Freepik.com</a>
  </figcaption>
</figure

In the last few years, I've had the pleasure to work with a lot of talented Software Engineers.
One thing that struck me is, that many of them did not have any working knowledge of `Makefiles` 
and why they are useful.

When faced with the task to automate a build process, they often roll their own shell scripts.
Common culprits are called `build.sh` or `run.sh` or `doall.sh` etc.  

They implement the same basic functionality over and over again:

* Parsing input parameters and environment variables.
* Manually managing dependencies between build steps.
* Error handling... maybe.

Along the way, they keep doing the same basic mistakes:

* Incorrectly handling [input parameters](http://www.pixelbeat.org/programming/shell_script_mistakes.html) and [environment variables](https://en.wikipedia.org/wiki/Shellshock_(software_bug)).
* Missing dependencies between build steps.
* [Forgetting to handle errors](http://www.davidpashley.com/articles/writing-robust-shell-scripts/) and &mdash; even worse &mdash; carrying on with the program execution.

### Makefiles are scary!

If you think that `make` is scary, you probably think of complicated build machinery for [big](https://community.kde.org/Guidelines_and_HOWTOs/Build_from_source) [software](https://chromium.googlesource.com/chromium/src/+/lkcr/docs/linux_build_instructions.md) projects.
It doesn't need to be that way. Let's hear what the author of `make`, [Stuart Feldman](https://en.wikipedia.org/wiki/Stuart_Feldman) has to say:

> It began with an elaborate idea of a dependency analyzer, boiled down to something much simpler, and turned into Make that weekend. Use of tools that were still wet was part of the culture. Makefiles were text files, not magically encoded binaries, because **that was the Unix ethos: printable, debuggable, understandable stuff.**  
>
> &mdash; [The Art of Unix Programming (2003)](http://nakamotoinstitute.org/static/docs/taoup.pdf)

### Makefiles are simple!

Before I leave the house, I need to get dressed.
I use the same simple routine every time:
Underpants, trousers, shirt, pullover, socks, shoes, jacket.
Most likely you also have a routine, even though yours might be different.

Some of these steps depend on each other.  
`Make` is good for handling dependencies.  
Let's try to express my routine as a `Makefile`.

```make
dress: trousers shoes jacket
	@echo "All done. Let's go outside!"

jacket: pullover
	@echo "Putting on jacket."

pullover: shirt
	@echo "Putting on pullover."

shirt:
	@echo "Putting on shirt."

trousers: underpants
	@echo "Putting on trousers."

underpants:
	@echo "Putting on underpants."

shoes: socks
	@echo "Putting on shoes."

socks: pullover
	@echo "Putting on socks."
```

If we execute the `Makefile`, we get the following output:

```
$ make dress
Putting on underpants.
Putting on trousers.
Putting on shirt.
Putting on pullover.
Putting on socks.
Putting on shoes.
Putting on jacket.
All done. Let's go outside!
```

### What just happened?

Noticed how the steps are in the correct order?
By plainly writing down the dependencies between the steps, `make` helps us to execute them correctly.

Each build step has the following structure:

```make
target: [dependencies]
	<shell command to execute>
	<shell command to execute>
	...
```

* The first target in a `Makefile` will be executed by default when we call `make`.  
* The order of the targets does not matter.  
* Shell commands must be indented with a tab.
* Add an `@` sign to suppress output of the command that is executed.
* If `target` isn't a file you want to build, please add `.PHONY <target>` at the end of the build step.
  Common phony targets are: clean, install, run,...

  ```make
  install: 
  	npm install
  .PHONY: install
  ```
  Otherwise, if somebody creates an `install` directory, `make` will silently fail, because the build target already exists.

Congratulations! You've learned 90% of what you need to know about `make`.

### Next steps

Real `Makefiles` can do much more! They will [only build the files that have changed](https://stackoverflow.com/a/3798609/270334) instead of doing a full rebuild.
And they will do [as much as possible in parallel](https://stackoverflow.com/a/3841803/270334).
